# Проект Тарифный Калькулятор

Сервис для расчёта стоимости доставки грузов с учётом **веса, габаритов и расстояния**.

## Используемые технологии
- Java 17
- Spring Boot 3
- Maven 3
- JUnit 5
- Swagger
- Mockito
- Swagger
- Docker

## Основные возможности
- Расчёт стоимости доставки по весу груза
- Расчёт стоимости доставки по объёму груза
- Выбор максимальной стоимости между расчётом по весу и объёму
- Учёт минимальной стоимости доставки
- Учёт расстояния между пунктами (формула гаверсинусов)
- Масштабирование стоимости доставки в зависимости от расстояния
- Валидация входных данных (вес, габариты, координаты)
- REST API с документацией Swagger

## Структура приложения

Приложения разделено на maven модули, каждый
модуль отвечает за свою область применения:

- [app](app)

Содержит класс запуска приложения, настройки связывания бинов,
чтение значений из файла [application.yml](app/src/main/resources/application.yml)

- [domain](domain)

В модуле находятся все классы участвующие в бизнес логике, такие как Упаковка,
Вес, Валюта, Стоимость. Класс не должен содержать зависимостей на фреймворк Spring Boot и на другие модули проекта.

- [useCase](useCase)

В модуле находится все процессы бизнес логики использующие доменные
классы. Класс не должен содержать зависимостей на фреймворк Spring Boot, только зависит от модуля `domain`

- [web](web)

В модуле находится контроллеры, этот модуль единственный общается с
внешним миром. Содержит зависимости Spring Boot и `domain`, `useCase`.

### Алгоритм расчёта стоимости
1. Рассчитывается стоимость доставки:
   - по весу всех упаковок
   - по объёму всех упаковок
2. Выбирается максимальная из двух стоимостей
3. Применяются минимальные значения стоимости (по весу и объёму)
4. Рассчитывается расстояние между пунктами отправления и назначения
5. Если расстояние превышает минимальное:
```text
ИтоговаяЦена = БазоваяЦена × (Расстояние / МинимальноеРасстояние)
```
6. Итоговая стоимость округляется до 2 знаков после запятой в большую сторону

### Пример запроса
```http request
POST /api/v1/calculate
```
```json
{
  "packages": [
    {
      "weight": 4564,
      "length": 345,
      "width": 589,
      "height": 234
    }
  ],
  "currencyCode": "RUB",
  "departure": {
    "latitude": 55.030204,
    "longitude": 82.920430
  },
  "destination": {
    "latitude": 47.222109,
    "longitude": 39.718813
  }
}
```
### Пример ответа
```json
{
  "totalPrice": 1643.69,
  "minimalPrice": 500.00,
  "currencyCode": "RUB"
}
```
## Локальный запуск

### Требования

Проект использует синтаксис Java 17. Для локального запуска вам потребуется
установленный JDK 17.

### Используя среду разработки IDEA

Откройте проект. Дождитесь индексации. Создайте конфигурацию запуска
или запустите main метод класса [app/src/main/java/ru/fastdelivery/Main.java](app/src/main/java/ru/fastdelivery/Main.java)

### Используя Docker

Вы можете создать Docker образ с приложением и запустить его.

Соберите проект:

```shell
./mvnw clean package
```

Создать образ:

```shell
docker build -t ru.fastdelivery:latest .
```

Запуск контейнера:

```shell
docker run -p 8081:8080 ru.fastdelivery:latest
```

### Используя JAR

Соберите проект:

```shell
./mvnw clean package
```

Запустите Jar файл:

```shell
java -jar app/target/app-1.0-SNAPSHOT.jar
```

## Тестирование кода

### Запуск тестов

Используя встроенный Maven Wrapper запустите
фазу тестов, при этом будет произведена проверка
стиля кода (checkstyle). Отчеты по checkstyle
найдете в файле
[target/site/checkstyle-aggregate.html](target/site/checkstyle-aggregate.html) 

Linux/macOs:

```shell
./mvnw clean test
```

Windows:

```shell
./mvnw.cmd clean test
```

## Swagger

При запущенном приложение вы можете
выполнять запросы используя интерфейс Swagger. 

http://localhost:8080/swagger-ui/index.html